---
title: "Szczepienia"
author: "Szymon Lisowski"
date: "7/12/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Wczytywanie danych historycznych szczepień

```{r}
files_1 <- list.files(path = "/Users/mr.fox/Github/COVID_wg_powiatow/Raw_data/danehistoryczne_szczepienia 2", pattern = "rcb_pow_szczepienia.csv")

setwd("/Users/mr.fox/Github/COVID_wg_powiatow/Raw_data/danehistoryczne_szczepienia 2")

df_no_date <- ldply(.data = files_1, .fun = function(i) {read.csv(i, header = TRUE, sep = ";", dec = ",", stringsAsFactors = FALSE, na.strings = c("", "NA")) })

date_column <- data_frame(stan_rekordu_na = rep(seq.Date(as.Date("2020-12-24")-1, as.Date("2021-01-27")-1, by = "day"), 381)) %>% arrange(stan_rekordu_na)

df_date_1 <- cbind(df_no_date, date_column)

write.csv(df_date_1, "/Users/mr.fox/Github/COVID_wg_powiatow/Processed_data/szczepienia.csv")
```

## Wczytywanie szczegółowych danych historycznych szczepień dla powiatów oraz gmin.

```{r}
szczepienia <- read.csv("/Users/mr.fox/Desktop/Szczepienia.csv", sep = ";", dec = ",", header = TRUE, check.names = FALSE)

szczepienia_1 <- data.frame(colnames(szczepienia)) 
szczepienia_2 <- data.frame(df = gsub("[\\]r[\\]n", ";", szczepienia_1$colnames.szczepienia.)) 

write_csv(szczepienia_2, "/Users/mr.fox/Desktop/szczepienia_2.csv")

df <- read.csv("/Users/mr.fox/Desktop/szczepienia_2.csv", sep = ";", dec = ",", header = TRUE, check.names = FALSE, row.names=NULL) %>% filter(row.names != ":") %>% dplyr::mutate(across(where(is.character), ~ na_if(.,"")))

wojewodztwo_nazwa <- df %>% select(df) %>% filter(!df == "NA")
powiat_nazwa <- df %>% select(1) %>% filter(row_number() %in% seq(2,nrow(df), by = 12)) 
gmina_nazwa <- df %>% select(1) %>% filter(row_number() %in% seq(3,nrow(df), by = 12)) 
zaszczepieni_pelna_dawka <- df %>% select(1) %>% filter(row_number() %in% seq(4,nrow(df), by = 12)) %>% mutate(row.names = gsub(",", ".", row.names))
przyrost_zaszczepionych_od_2021_08_01 <- df %>% select(1) %>% filter(row_number() %in% seq(5,nrow(df), by = 12)) %>% mutate(row.names = gsub(",", ".", row.names)) 
liczba_ludnosci <- df %>% select(1) %>% filter(row_number() %in% seq(6,nrow(df), by = 12)) 
zaszczepieni_pacjenci_jedna_dawka <- df %>% select(1) %>% filter(row_number() %in% seq(7,nrow(df), by = 12)) 
zaszczepieni_pelna_dawka <- df %>% select(1) %>% filter(row_number() %in% seq(8,nrow(df), by = 12)) 
grupa_wiekowa_12_19 <- df %>% select(1) %>% filter(row_number() %in% seq(9,nrow(df), by = 12)) 
grupa_wiekowa_20_39 <- df %>% select(1) %>% filter(row_number() %in% seq(10,nrow(df), by = 12)) 
grupa_wiekowa_40_59 <- df %>% select(1) %>% filter(row_number() %in% seq(11,nrow(df), by = 12)) 
grupa_wiekowa_60_69 <- df %>% select(1) %>% filter(row_number() %in% seq(12,nrow(df), by = 12)) 
grupa_wiekowa_70_plus <- df %>% select(1) %>% filter(row_number() %in% seq(12,nrow(df), by = 12)) 

df <- bind_cols(grupa_wiekowa_60_69, grupa_wiekowa_70_plus)

df <- bind_cols(wojewodztwo_nazwa, powiat_nazwa, gmina_nazwa, zaszczepieni_pelna_dawka, przyrost_zaszczepionych_od_2021_08_01, liczba_ludnosci, zaszczepieni_pacjenci_jedna_dawka, zaszczepieni_pelna_dawka, grupa_wiekowa_12_19, grupa_wiekowa_20_39, grupa_wiekowa_40_59, grupa_wiekowa_60_69, grupa_wiekowa_70_plus)

colnames(df) <- c("wojewodztwo_nazwa", "powiat_nazwa", "gmina_nazwa", "zaszczepieni_pelna_dawka", "przyrost_zaszczepionych_od_2021_08_01", "liczba_ludnosci", "zaszczepieni_pacjenci_jedna_dawka", "zaszczepieni_pelna_dawka", "grupa_wiekowa_12_19", "grupa_wiekowa_20_39", "grupa_wiekowa_40_59", "grupa_wiekowa_60_69", "grupa_wiekowa_70_plus")

df <- df %>% arrange(wojewodztwo_nazwa, powiat_nazwa, gmina_nazwa)

write.csv(df, "/Users/mr.fox/Github/COVID_wg_powiatow/Processed_data/szczepienia_wg_gmin.csv")
```

## Pierwsze próby (nieudolne) wprowadzenia pętli w  celu zastąpienia kodu z wierszów 40:52 w dokumencie.

```{r}
# cols <- c("powiat_nazwa", "gmina_nazwa", "zaszczepieni_pelna_dawka", "przyrost_zaszczepionych_od_2021_08_01", "liczba_ludnosci", "zaszczepieni_pacjenci_jedna_dawka", "zaszczepieni_pelna_dawka", "grupa_wiekowa_12_19", "grupa_wiekowa_20_39", "grupa_wiekowa_40_59", "grupa_wiekowa_60_69", "grupa_wiekowa_70_plus")
# 
# cols_num <- 2:13
# 
# for(x in 2:13) {
#   y <- df %>% select(1) %>% filter(row_number() %in% seq(x,nrow(df), by = 12)) %>% dplyr::rename(cols = row.names) 
#   print(y)
# }
```

